# 工作方法论

## 1. 先确认再动手

- 用户说的名词可能有歧义，动手前先确认：**改哪个文件？影响哪些地方？**
- 项目中可能有多个相似命名的文件，不要猜，问清楚
- 删除/重构前检查依赖关系，避免编译报错

## 1.5 紧急停止规则

- **用户开始骂人 → 立即停下手里所有工作，等待用户指挥**
- 不要自作主张继续操作，不要试图"修复"，等用户说怎么做
- 回滚前必须先保存当前文件状态（`cp` 备份或 `git stash`），绝不能直接 `git checkout` 丢掉未保存的修改

## 2. 先找最佳实践

- 遇到不熟悉的技术问题，先搜索标准做法和最佳实践
- 不要自己发明轮子，尤其是 UI 框架相关的东西
- 用成熟方案，不要手动转换/hack
- 例如：SwiftUI 显示 SVG 应该用 NSImage + NSViewRepresentable，不要手动转 path
- 例如：macOS 图标应该用 iconset + iconutil，不要用 sips 直接转

## 3. UI 尺寸一次算清

改 UI 前先列出所有约束条件并计算：

```
容器尺寸 - padding - margin = 可用空间
元素原始比例 → 目标尺寸
```

一次算完所有数值，一次改对。不要改一点看一点反复试错。

## 4. 听清楚用户说的话

- 用户说"别动"就别动
- 用户说"只改这个"就只改这个
- 用户说"别打了"就停下来
- 不要自作主张加额外修改
- 不要假设用户的意图，有疑问就问

## 5. 改完验证

- 修改后用 `grep` 或 `cat` 等工具验证磁盘文件是否真的更新
- 改完一个文件就要确认改动生效，不能直接假设改完的东西就已经正确存盘了，不要假设 strReplace 一定成功。
- 测试之前需要验证所有改动都已经在磁盘上被正确保存了。不要怕麻烦，否则后患无穷

## 6. 构建和打包流程

- `bundle_app.sh` 优先使用 `.build/release/` 下的 executable
- 改完代码后如果要打包测试，**必须先 `swift build -c release`**，不能只 build debug
- 流程：`swift build -c release` → `bash bundle_app.sh` → `open GhosTYPE.app`
- **不要用 `swift build -c debug` 然后直接 bundle**，否则打包的还是旧的 release 版本

## 7. 完整思考整个流程

- 写脚本时参考已有的类似脚本，不要漏掉关键步骤（如签名）
- 考虑升级场景：已安装用户的本地数据（UserDefaults、CoreData）会保留
- 考虑边界情况：新用户 vs 老用户、首次安装 vs 升级安装
- 动手前先想清楚完整流程，不要边做边补
