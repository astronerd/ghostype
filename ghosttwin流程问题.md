
Ghost Twin 完整流程（产品视角）
1. 新用户首次打开孵化室
用户看到一个 CRT 显示器，里面有个很暗的 Ghost 幽灵。底部显示闲置文案（打字机效果）。

状态：Lv.1，0 XP，空档案，没有人格标签。

问题 ❶：新用户没有任何引导，不知道这个页面是干什么的，也不知道怎么开始。校准按钮不会出现（因为 hasCompletedProfiling 为 false，profileText 是空的），但用户不知道为什么不能校准，也不知道怎么触发第一次构筑。

问题 ❷：第一次构筑的触发条件是"升级"，但升级需要 10000 XP。新用户要说 10000 个字才能触发第一次构筑，在此之前 Ghost Twin 完全是空壳——没有人格档案、不能校准、标签为空。这个冷启动体验很差。


[TODO] 这里设置一个 lvl 0，需要 2000 字即可升级，开启 lvl 1。校准问题的 UI 处可以加上一个提示文案“你的 ghost twin 需要 2000 字输入即可激活”之类的。lvl0-lvl1 的构筑很简单，所以这里可能需要一个简化版的构筑 skill，这个构筑主要是提出框架和不确定的地方，以便后续的校准和构筑能更好发挥

2. 用户日常使用语音输入
每说一个字 +1 XP。语料被收集到 asr_corpus.json。

没有问题，这条路径设计得很干净。

3. 积累到 10000 XP，触发升级
升级仪式动画播放（闪烁 → 熄灭 → Ghost 变亮）。同时后台触发构筑（profiling）。

构筑流程：把所有未消费的 ASR 语料 + 校准记录 + 当前档案喂给 profiling skill，LLM 输出一份「形/神/法」分析报告。报告全文存为 profileText，末尾的 JSON 摘要里的 refined_tags 存为 personalityTags。

问题 ❸：构筑的输入里有"上一轮构筑报告"这个字段，但代码里传的是 nil（previousReport: nil）。也就是说每次构筑都不知道上一轮写了什么，增量构筑规则形同虚设。

[TODO] 这里就要把每一轮新的构筑，都要包括上一轮的结果，上一轮校准的所有问题、答案以及分析，然后用户说过的话的原始 ASR 数据都放进去。你这里不能再用代码写，不能写在代码里了，你要动态地在 Skill 里加载这些上下文作为 User message。


4. 构筑完成后，校准按钮出现
现在 profileText 不为空了，hasCompletedProfiling 为 true，用户可以看到"点击校准"的提示。

5. 用户点击校准
系统调用 calibration skill 的出题模式，把当前 profile + 最近校准记录发给 LLM，LLM 返回一道情境题（场景 + 3 个选项）。

题目以"热敏纸条"的形式弹出在 CRT 屏幕上。

问题 ❹：出题 skill 收到的上下文里有 profile 全文和历史记录，但 system prompt 之前太简陋，没有告诉 LLM 怎么利用这些信息来出有针对性的题。（这个刚刚已经优化了）

[TODO] 这个地方你要根据我们刚才说的去调整。输入的上下文，以及我刚才看，好像你分析什么的都是用中文的，这里是有问题的。我们要支持中英双语，所以其实要根据用户说的语言，以及他设置的语言。或者是这个我不太确定，一般来说是怎么做的，但是要符合用户使用的语言来生成对应的回应和问题，以及他的人格档案。



6. 用户选择一个选项（或自己写答案）
系统调用 calibration skill 的分析模式，把题目 + 用户选择 + 当前 profile 发给 LLM。

LLM 返回：profile_diff（layer + changes + new_tags）、ghost_response（反馈语）、analysis（分析过程）。

问题 ❺（就是你刚说的）：分析结果是结构化的标签（new_tags），信息量太小。应该输出完整的人格增量描述文本，而不是几个标签。标签传到 profiling 那边会丢失上下文。

问题 ❻：analysis 字段（分析推理过程）被解析出来后……没有被存储。代码里只存了 profileDiff（序列化为 JSON 字符串）和 ghostResponse，analysis 被丢掉了。这意味着 LLM 的推理过程完全丢失，后续构筑时看不到。

7. XP +300，检查是否升级
如果升级了 → 触发升级仪式 + 构筑。 如果没升级 → 只更新 tags 和 XP。

问题 ❼：不升级的情况下，校准产生的 new_tags 直接追加到 personalityTags 数组里，但 profileText 不会更新。也就是说标签和档案全文是割裂的——标签可能已经有 10 个了，但 profileText 还是上次构筑时的内容。只有升级触发构筑时，profileText 才会被重写。

[TODO] 这里用户回答完问题以后，要把问题、答案（无论是用户选择的，还是用户自己输入的答案）和 AI 的分析都作为这一轮的上下文，用于下一轮的构筑。



8. 升级触发构筑
构筑时的输入：

上一轮构筑报告（但传的是 nil，见问题 ❸）
未消费的 ASR 语料
所有校准记录
当前 profile
问题 ❽：校准记录传的是 recordStore.loadAll()（全部 20 条），没有按等级过滤。如果用户在 Lv.1 做了 3 题、Lv.2 做了 3 题，Lv.2 升级时构筑会看到 Lv.1 的记录，但那些记录已经在 Lv.1 的构筑中被消费过了。ASR 语料有 consumedAtLevel 标记来避免重复消费，但校准记录没有这个机制。

9. 每日限制
每天最多 3 次校准，UTC 0 点重置。超过后校准按钮消失，显示闲置文案。

没有问题。

10. 中断恢复
app 被杀掉后重新打开，检查是否有未完成的校准/构筑流程，自动恢复。

没有问题，设计得很完善。

问题汇总
#	问题	严重程度
❶	新用户无引导，不知道怎么开始	高
❷	冷启动要说 10000 字才能触发首次构筑，之前是空壳	高
❸	构筑时 previousReport 传 nil，增量构筑失效	中
❹	出题 prompt 太简陋（已修复）	已修复
❺	校准分析输出标签而非完整人格描述	高
❻	校准的 analysis 推理过程被丢弃	中
❼	标签和 profileText 割裂，不升级时档案不更新	中
❽	构筑时校准记录没有按等级过滤，重复消费	低
你觉得这些问题的优先级对吗？要不要针对这些做一个整体的重构 spec？